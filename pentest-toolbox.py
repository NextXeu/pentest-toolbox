"""
Project name: Pentest ToolBox
Version: 1.0
Copyright© x/x/2022, DEMARD Jérémy et Xavier 

"""

from modules.cvelookup import CVELookUp
from modules.searchsploit import searchsploit
from modules.dnslookup import DNSLookUp
from modules.certificate import getCertificate
from modules.portscan import Nmap
from modules.usernamecheck import check_username_availability
from modules.fpdf import renderHTML
from menu import displayHeader, displayMenu
from datetime import datetime

if __name__ == "__main__":

    displayHeader()
    displayMenu()
    HTML = ""
    HTML += f"<h1>Rapport du {datetime.now()}</h1><br>"

    option = int(input(">>> Choose an option\n>>> "))
    while option != 99:
        if option == 1:
            CVE_ID = "CVE-2021-40438"
            print(CVELookUp(CVE_ID))

            dns_lookup = DNSLookUp('supdevinci.fr')
            print(dns_lookup)

            certif = getCertificate('supdevinci.fr')
            print(certif)
        
        elif option == 2:
            scan, version = Nmap('supdevinci.fr')
            print(scan)

        elif option == 3:
            service = str(input(">>> Search for exploits on a service (ex: wordpress 4.0)\n>>> "))
            exploit = searchsploit(service)
            HTML += f"<h2>Potentielles volnérabilités concernant {service}</h2><br>"
            HTML += f"<p>{searchsploit(service, True)}</p>"
            print(exploit)

        elif option == 4:
            usernamecheck = check_username_availability('ver')
            print(usernamecheck)
        
        elif option == 5:
            domain = str(input(">>> Enter target domain name\n>>> "))

            # DNS
            HTML += f"<h2>Informations DNS {domain}</h2><br>"
            HTML += f"<p>{DNSLookUp(domain, True)}</p>"

            # Certificat
            HTML += f"<h2>Informations sur le certificat {domain}</h2><br>"
            HTML += f"<p>{getCertificate(domain, True)}</p>"

            # Scan NMAP
            resScan, versions = Nmap(domain, True)
            HTML += f"<h2>Scan de port sur {domain}</h2><br>"
            HTML += f"<p>{resScan}</p>"

            # Exploits
            HTML += f"<h2>Potentielles vulnérabilités trouvées</h2><br>"
            for vuln in versions:
                HTML += f"<h3>Service: {vuln}</h3><br><p>{searchsploit(vuln, True)}</p><br>"
            
            break

        displayMenu()
        option = int(input(">>> Choose an option\n>>> "))

    renderHTML(HTML) # Generate PDF
    

    
    

    